<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Сердце из фейерверков</title>
<style>
html,body { height:100%; margin:0; }
body { background: #000; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; overflow: hidden; color: #fff; }
.center { position: absolute; left:50%; top:50%; transform: translate(-50%,-50%); display:flex; align-items:center; justify-content:center; z-index: 5; }
button#start { background: #fff; color: #000; border: none; padding: 18px 34px; font-size: 20px; border-radius: 10px; cursor: pointer; box-shadow: 0 6px 18px rgba(255,255,255,0.06), 0 2px 6px rgba(0,0,0,0.4); transition: transform .15s ease, opacity .3s ease; user-select: none; }
button#start:active { transform: translateY(1px) scale(.995); }
button#start.hidden { opacity: 0; transform: scale(.9) translateY(-8px); pointer-events: none; }
canvas#fx { position: absolute; left:0; top:0; width:100%; height:100%; display:block; z-index:1; }
.hint { position: absolute; left:50%; top:calc(50% + 70px); transform: translateX(-50%); color: rgba(255,255,255,0.6); font-size: 13px; z-index:4; transition: opacity .3s ease; text-align:center; max-width:90%; }
.hint.hidden { opacity:0; pointer-events:none; }
</style>
</head>
<body>
<div class="center">
  <button id="start">Нажми меня</button>
</div>
<div class="hint" id="hint">Кликни по кнопке — смотри, как собирается сердце из фейерверков ✨</div>
<canvas id="fx"></canvas>
<script>
const canvas = document.getElementById('fx');
const ctx = canvas.getContext('2d');
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.addEventListener('resize',resize);
resize();

const palette=['#FF4D6D','#FF7A9B','#FFD166','#FF6B6B','#FF9A6B','#FFD1DC','#FF5E9E'];
let heartParticles=[],sparks=[],textParticles=[],showHeart=false,showText=false,heartFormed=false,lastTime=performance.now();

class Particle{
  constructor(x,y,tx,ty,color){
    this.x=x;this.y=y;this.tx=tx;this.ty=ty;this.vx=(Math.random()-0.5)*6;this.vy=(Math.random()-0.5)*6;
    this.size=Math.random()*2+1;this.color=color;this.phase='chaotic';this.age=0;
  }
  update(dt){
    if(this.phase==='chaotic'){this.x+=this.vx;this.y+=this.vy;this.vx*=0.95;this.vy*=0.95;}
    else if(this.phase==='assembling'){this.vx+=(this.tx-this.x)*0.05;this.vy+=(this.ty-this.y)*0.05;this.vx*=0.8;this.vy*=0.8;this.x+=this.vx;this.y+=this.vy;}
    this.age+=dt;
  }
  draw(ctx){ctx.fillStyle=this.color;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();}
}

class Spark{
  constructor(x,y,vx,vy,color){this.x=x;this.y=y;this.vx=vx;this.vy=vy;this.life=Math.random()*0.8+0.4;this.size=Math.random()*1.6+0.6;this.color=color;}
  update(dt){this.vy+=60*dt;this.x+=this.vx*(dt*60);this.y+=this.vy*(dt*60);this.life-=dt;}
  draw(ctx){ctx.globalAlpha=Math.max(0,this.life/1.2);ctx.fillStyle=this.color;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;}
}

function heartPoint(t,scale=1){const x=16*Math.pow(Math.sin(t),3);const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));return {x:x*scale,y:y*scale};}
function generateHeartPoints(count,cx,cy,scale){const pts=[];for(let i=0;i<count;i++){const t=(i/count)*Math.PI*2;const p=heartPoint(t,scale);pts.push({x:cx+p.x,y:cy+p.y});}return pts;}

function spawnFireworkBurst(x,y,count){
  const baseColor=palette[Math.floor(Math.random()*palette.length)];
  for(let i=0;i<count;i++){const ang=Math.random()*Math.PI*2;const speed=Math.random()*3+1.2;sparks.push(new Spark(x,y,Math.cos(ang)*speed*6,Math.sin(ang)*speed*6,baseColor));}
}

function createTextParticles(text,fontSize){
  const tempCanvas=document.createElement('canvas');
  const tempCtx=tempCanvas.getContext('2d');
  tempCanvas.width=canvas.width; tempCanvas.height=canvas.height;
  tempCtx.font=`${fontSize}px sans-serif`; tempCtx.fillStyle='white'; tempCtx.textAlign='center'; tempCtx.textBaseline='middle'; tempCtx.fillText(text,canvas.width/2,canvas.height/2);
  const data=tempCtx.getImageData(0,0,tempCanvas.width,tempCanvas.height).data;
  const arr=[];
  for(let y=0;y<tempCanvas.height;y+=6){for(let x=0;x<tempCanvas.width;x+=6){
    if(data[(y*tempCanvas.width+x)*4+3]>128){let startX,startY;const corner=Math.floor(Math.random()*4);
      if(corner===0){startX=0;startY=0;} if(corner===1){startX=canvas.width;startY=0;} if(corner===2){startX=0;startY=canvas.height;} if(corner===3){startX=canvas.width;startY=canvas.height;}
      arr.push(new Particle(startX,startY,x,y,'white'));
    }
  }}
  return arr;
}

function updateTextParticles(dt){for(let p of textParticles)p.update(dt);}
function drawTextParticles(ctx){for(let p of textParticles)p.draw(ctx);}

function loop(now){
  const dt=Math.min(0.035,(now-lastTime)/1000);lastTime=now;
  ctx.fillStyle='rgba(0,0,0,0.25)';ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let p of heartParticles){if(p.phase==='chaotic')p.phase='assembling';p.update(dt);p.draw(ctx);}
  for(let i=sparks.length-1;i>=0;i--){sparks[i].update(dt);sparks[i].draw(ctx);if(sparks[i].life<=0)sparks.splice(i,1);}

  if(showHeart&&!heartFormed){
    let settled=0;
    for(let p of heartParticles){if(Math.abs(p.x-p.tx)<2&&Math.abs(p.y-p.ty)<2)settled++;}
    if(settled>=heartParticles.length*0.9){textParticles=createTextParticles('Ты чудо',Math.floor(Math.min(canvas.width,canvas.height)/8));showText=true;heartFormed=true;}
  }

  if(showText){updateTextParticles(dt);drawTextParticles(ctx);}
  requestAnimationFrame(loop);
}

document.getElementById('start').addEventListener('click',()=>{
  document.getElementById('start').classList.add('hidden');document.getElementById('hint').classList.add('hidden');
  const centerX=canvas.width/2;const centerY=canvas.height/2-Math.min(80,canvas.height*0.05);
  const scale=Math.min(canvas.width,canvas.height)/36;const total=Math.floor(1200*Math.min(1,Math.min(canvas.width,canvas.height)/800));
  heartParticles=generateHeartPoints(total,centerX,centerY,scale).map(p=>new Particle(Math.random()*canvas.width,canvas.height+Math.random()*200,p.x,p.y,palette[Math.floor(Math.random()*palette.length)]));
  showHeart=true;
  for(let i=0;i<5;i++)spawnFireworkBurst(centerX,centerY,60);
  loop(performance.now());
});

</script>
</body>
</html>
