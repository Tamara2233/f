<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Шахматная задача — мат королевой + анимация (без графики)</title>
<style>
  :root{
    --light:#f0d9b5;
    --dark:#b58863;
    --highlight: #ffd966;
    --board-size: 560px;
    --square-size: calc(var(--board-size) / 8);
    --accent: #4a90e2;
  }
  body{
    font-family: Inter, Roboto, system-ui, -apple-system, "Segoe UI", sans-serif;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    margin:0;
    background:linear-gradient(180deg,#0f172a 0%, #071029 100%);
    color:#fff;
    flex-direction:column;
    gap:18px;
    padding:24px;
  }
  h1{margin:0 0 6px 0; font-size:18px; font-weight:600;}
  .note{font-size:13px; color:#cbd5e1; margin-bottom:6px;}
  #boardWrap{width:var(--board-size);}
  .board{
    width:var(--board-size);
    height:var(--board-size);
    display:grid;
    grid-template-columns:repeat(8,1fr);
    box-shadow:0 10px 30px rgba(2,6,23,0.7);
    border-radius:10px;
    overflow:hidden;
    position:relative;
    transform-origin:center;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.05));
  }
  .square{
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:26px;
    user-select:none;
    cursor:pointer;
    transition: background 180ms, transform 130ms;
    position:relative;
  }
  .square.light{ background: var(--light); color:#111; }
  .square.dark{ background: var(--dark); color:#111; }
  .square.highlight{ outline: 4px solid rgba(255,217,102,0.55); box-sizing:border-box; }
  .piece{
    font-size:36px;
    line-height:1;
    transform: translateZ(0);
  }
  .small-info{
    font-size:13px;
    color:#d1d5db;
    margin-top:8px;
    text-align:center;
  }
  /* animation area */
  #scene{
    width:640px;
    max-width:95vw;
    height:360px;
    background: linear-gradient(180deg, #021428 0%, #02111b 100%);
    border-radius:12px;
    box-shadow: 0 10px 40px rgba(2,6,23,0.7);
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
    position:relative;
    display:none; /* hidden until triggered */
  }
  /* simple silhouettes */
  .stage{
    width:100%;
    height:100%;
    position:relative;
  }
  svg{ width:100%; height:100%; display:block; }
  /* sword swing */
  @keyframes swing {
    0% { transform-origin: 60% 20%; transform: rotate(-40deg); }
    50% { transform: rotate(15deg); }
    100% { transform: rotate(-10deg); }
  }
  @keyframes swoop {
    0% { transform: translateX(-80px) rotate(0deg); opacity:1; }
    70% { transform: translateX(0px) rotate(6deg); opacity:1; }
    100% { transform: translateX(30px) rotate(12deg); opacity:0; }
  }
  @keyframes fall {
    0% { transform: translateY(0) rotate(0deg); opacity:1; }
    100% { transform: translateY(120px) rotate(90deg); opacity:0.9; }
  }
  /* helper UI */
  #msg{
    margin-top:10px;
    font-size:14px;
    color:#e2e8f0;
  }
  .btn{
    background:linear-gradient(180deg,#2563eb,#1e40af);
    color:white;
    border:none;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }
  .muted{ color:#94a3b8; font-size:13px; }
  /* subtle feedback */
  .shake { animation: shake 430ms; }
  @keyframes shake {
    0%{ transform: translateX(0) }
    20%{ transform: translateX(-6px) }
    40%{ transform: translateX(6px) }
    60%{ transform: translateX(-4px) }
    80%{ transform: translateX(4px) }
    100%{ transform: translateX(0) }
  }
</style>
</head>
<body>
  <div style="text-align:center;">
    <h1>Шахматная задачa — мат королевой в 1 ход</h1>
    <div class="note">Кликни по белой ♕ (королеве), затем по клетке, где ставится мат. После — запускается стилизованная 2D-анимация (без кровавых деталей).</div>
  </div>

  <div id="boardWrap">
    <div id="board" class="board" aria-hidden="false"></div>
    <div class="small-info">Позиция: <span class="muted">Белые: Kg1, Qh6. Чёрные: Kg8, pg7. Ход белых.</span></div>
    <div id="msg"></div>
  </div>

  <div id="scene">
    <div class="stage" id="stageContainer">
      <!-- SVG will be injected here -->
    </div>
  </div>

<script>
/* ---------- Простая шахматная доска без библиотек ----------
   Позиция: FEN: "6k1/6p1/7Q/8/8/8/8/6K1 w - - 0 1"
   Белая королева на h6 (хотим Qxg7#). Мы намеренно разрешаем выбор только королевы.
------------------------------------------------------------ */

const BOARD = document.getElementById('board');
const MSG = document.getElementById('msg');
const SCENE = document.getElementById('scene');
const STAGE = document.getElementById('stageContainer');

const files = ['a','b','c','d','e','f','g','h'];
const ranks = [8,7,6,5,4,3,2,1];

// piece placements: use unicode
// white queen at h6, white king g1; black king g8, black pawn g7
const pieces = {
  'h6': '♕', // white queen
  'g1': '♔', // white king
  'g8': '♚', // black king
  'g7': '♟'  // black pawn
};

let selected = null;
let moving = false;
const correctTarget = 'g7';
const queenSquare = 'h6';

// build grid
function makeBoard(){
  BOARD.innerHTML = '';
  for(let r=0;r<8;r++){
    for(let f=0;f<8;f++){
      const sq = files[f]+ranks[r];
      const div = document.createElement('div');
      div.className = 'square ' + (((f + r) % 2 === 0) ? 'light' : 'dark');
      div.dataset.square = sq;
      div.id = 'sq-'+sq;
      div.addEventListener('click', onSquareClick);
      // place piece if exists
      if(pieces[sq]){
        const span = document.createElement('div');
        span.className = 'piece';
        span.textContent = pieces[sq];
        span.dataset.piece = pieces[sq];
        span.dataset.square = sq;
        // only queen should be selectable
        if(sq === queenSquare){
          span.style.cursor = 'pointer';
          span.title = 'Кликни, чтобы выбрать королеву';
          span.addEventListener('click', onPieceClick);
        } else {
          span.style.cursor = 'default';
        }
        div.appendChild(span);
      }
      BOARD.appendChild(div);
    }
  }
}
function onPieceClick(e){
  e.stopPropagation();
  const sq = e.currentTarget.dataset.square;
  if(sq !== queenSquare){ return; }
  selectQueen();
}
function selectQueen(){
  // highlight queen and target
  clearHighlights();
  selected = queenSquare;
  moving = true;
  const qEl = document.getElementById('sq-'+queenSquare);
  qEl.classList.add('highlight');
  const tEl = document.getElementById('sq-'+correctTarget);
  tEl.classList.add('highlight');
  MSG.textContent = 'Вы выбрали королеву. Кликни по выделенной клетке, чтобы поставить мат.';
}
function clearHighlights(){
  document.querySelectorAll('.square.highlight').forEach(s=>s.classList.remove('highlight'));
  selected = null; moving = false;
}
function onSquareClick(e){
  const sq = e.currentTarget.dataset.square;
  if(!moving){
    shake(MSG);
    MSG.textContent = 'Сначала выбери королеву (♕).';
    return;
  }
  // only allow clicking the designated target
  if(sq === correctTarget && selected === queenSquare){
    performQueenMove(queenSquare, correctTarget);
  } else {
    // incorrect square -> feedback
    MSG.textContent = 'Это не тот ход. Попробуй снова (клик на выделенную клетку).';
    shake(document.getElementById('boardWrap'));
    // keep highlights
  }
}
function performQueenMove(from, to){
  MSG.textContent = 'Ход выполнен — мат. Запуск анимации...';
  // animate queen moving: clone piece, absolute positioning
  const fromEl = document.getElementById('sq-'+from);
  const toEl = document.getElementById('sq-'+to);
  const piece = fromEl.querySelector('.piece');
  if(!piece){ finishAndShowScene(); return; }
  const clone = piece.cloneNode(true);
  clone.style.position = 'absolute';
  const boardRect = BOARD.getBoundingClientRect();
  const fromRect = fromEl.getBoundingClientRect();
  clone.style.left = (fromRect.left - boardRect.left) + 'px';
  clone.style.top  = (fromRect.top  - boardRect.top) + 'px';
  clone.style.width = fromRect.width + 'px';
  clone.style.height = fromRect.height + 'px';
  clone.style.display = 'flex';
  clone.style.alignItems = 'center';
  clone.style.justifyContent = 'center';
  clone.style.fontSize = '36px';
  clone.style.transition = 'all 560ms cubic-bezier(.2,.9,.2,1)';
  BOARD.appendChild(clone);
  // remove original piece from fromEl
  piece.remove();
  // compute target
  const toRect = toEl.getBoundingClientRect();
  requestAnimationFrame(()=>{
    clone.style.left = (toRect.left - boardRect.left) + 'px';
    clone.style.top  = (toRect.top  - boardRect.top) + 'px';
  });
  // also remove captured pawn (black pawn on g7) visually
  const captured = toEl.querySelector('.piece');
  if(captured) captured.remove();
  // after animation
  setTimeout(()=>{
    clone.remove();
    // place queen at destination
    const qSpan = document.createElement('div');
    qSpan.className = 'piece';
    qSpan.textContent = '♕';
    toEl.appendChild(qSpan);
    // small pause then switch to scene
    setTimeout(finishAndShowScene, 650);
  }, 700);
}
function finishAndShowScene(){
  // hide board
  document.getElementById('boardWrap').style.display = 'none';
  // show scene
  SCENE.style.display = 'block';
  runSceneAnimation();
}

/* ---------- Simple stylized non-graphic animation in SVG ----------
   - Фигура женщины (силуэт) делает взмах мечом (без крови)
   - Король-символ отпускается — падает, корона улетает
   - Линейная хронология: подготовка -> взмах -> падение -> финал
------------------------------------------------------------ */

function runSceneAnimation(){
  STAGE.innerHTML = `
<svg viewBox="0 0 1280 720" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" x2="0" y1="0" y2="1">
      <stop offset="0" stop-color="#06263d"/>
      <stop offset="1" stop-color="#02111b"/>
    </linearGradient>
    <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="8" result="blur"/>
      <feColorMatrix in="blur" type="matrix"
        values="0 0 0 0 0.12
                0 0 0 0 0.22
                0 0 0 0 0.30
                0 0 0 0.6 0"/>
    </filter>
  </defs>

  <rect width="100%" height="100%" fill="url(#bg)"/>
  <!-- stylized battleground -->
  <g id="ground" transform="translate(0,540)">
    <ellipse cx="640" cy="90" rx="520" ry="90" fill="rgba(0,0,0,0.25)"/>
  </g>

  <!-- KING silhouette on the right -->
  <g id="kingGroup" transform="translate(860,300)" opacity="1">
    <g id="kingBody" transform="translate(0,0)">
      <rect x="-28" y="-80" width="56" height="120" rx="10" fill="#e2e8f0" opacity="0.95"></rect>
      <circle cx="0" cy="-100" r="18" fill="#cbd5e1"></circle>
      <!-- crown -->
      <g id="crown" transform="translate(-0,-128)">
        <rect x="-24" y="0" width="48" height="12" rx="3" fill="#ffd166"></rect>
        <polygon points="-24,0 -12,-12 0,0 12,-12 24,0" fill="#ffb84d"></polygon>
      </g>
    </g>
  </g>

  <!-- WOMAN silhouette on the left with sword group -->
  <g id="womanGroup" transform="translate(360,320)">
    <g id="womanBody" transform="translate(0,0)">
      <rect x="-26" y="-84" width="52" height="108" rx="12" fill="#ffffff" opacity="0.95"></rect>
      <circle cx="0" cy="-106" r="16" fill="#ffffff"></circle>
    </g>
    <g id="swordPivot" transform="translate(18,-40)">
      <!-- sword -->
      <g id="sword" transform="rotate(-40)">
        <rect x="-6" y="-6" width="120" height="12" rx="4" fill="#cbd5e1"/>
        <rect x="110" y="-2" width="40" height="6" rx="3" fill="#ffd166"/>
      </g>
    </g>
  </g>

  <!-- some ambient particles (glow line) -->
  <g id="sparkles" opacity="0.0">
    <circle cx="520" cy="260" r="4" fill="#ffd966" opacity="0.0"/>
    <circle cx="700" cy="180" r="3" fill="#ffd966" opacity="0.0"/>
  </g>

</svg>
  `;

  const svg = STAGE.querySelector('svg');
  const sword = svg.getElementById('sword');
  const swordPivot = svg.getElementById('swordPivot');
  const king = svg.getElementById('kingGroup');
  const kingBody = svg.getElementById('kingBody');
  const crown = svg.getElementById('crown');
  const sparkles = svg.getElementById('sparkles');

  // Prepare CSS animations by adding style element to svg (for cross-browser)
  const style = document.createElementNS('http://www.w3.org/2000/svg','style');
  style.textContent = `
    @keyframes swingHands {
      0% { transform: rotate(-40deg); }
      35% { transform: rotate(20deg); }
      55% { transform: rotate(8deg); }
      100% { transform: rotate(0deg); }
    }
    @keyframes kingFall {
      0% { transform: translateY(0) rotate(0deg); opacity:1; }
      100% { transform: translateY(140px) rotate(80deg); opacity:0.9; }
    }
    @keyframes crownFly {
      0% { transform: translate(0px,0px) rotate(0deg); opacity:1; }
      80% { transform: translate(80px,-70px) rotate(20deg); opacity:1; }
      100% { transform: translate(120px,-140px) rotate(30deg); opacity:0; }
    }
  `;
  svg.appendChild(style);

  // animate sequence using timeouts
  // 1) small glow, pause
  setTimeout(()=>{ sparkles.style.opacity = '1'; }, 300);

  // 2) anticipation (slight lean)
  setTimeout(()=>{ svg.getElementById('womanBody').setAttribute('transform','translate(0,-6)'); }, 650);

  // 3) swing (keyframe applied to sword group)
  setTimeout(()=>{
    sword.style.transformOrigin = '20px 6px';
    sword.style.transformBox = 'fill-box';
    sword.style.animation = 'swingHands 700ms cubic-bezier(.2,.9,.2,1) forwards';
    // also small flash
    sparkles.style.opacity = '0.0';
  }, 1000);

  // 4) at swing moment -> king falls and crown flies
  setTimeout(()=>{
    king.style.transition = 'transform 900ms cubic-bezier(.2,.9,.2,1), opacity 900ms';
    king.style.transformOrigin = '50% 0%';
    king.style.animation = 'kingFall 900ms forwards';
    crown.style.transformOrigin = '50% 50%';
    crown.style.animation = 'crownFly 900ms forwards';
  }, 1400);

  // 5) final pose: camera focus & fade to message
  setTimeout(()=>{
    // subtle fade-out and show final text
    const overlay = document.createElement('div');
    overlay.style.position = 'absolute';
    overlay.style.left='0'; overlay.style.top='0'; overlay.style.width='100%'; overlay.style.height='100%';
    overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center';
    overlay.style.pointerEvents='none';
    overlay.innerHTML = '<div style="text-align:center;color:#e6eef8;"><div style="font-size:32px;font-weight:700;margin-bottom:8px;">Мат!</div><div style="font-size:16px;opacity:0.9;">Королева победила.</div></div>';
    SCENE.appendChild(overlay);
  }, 2400);

  // optional loop end: after some seconds, show a "Повторить / Вернуться" button
  setTimeout(()=>{
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.textContent = 'Повторить (на доске)';
    btn.style.position = 'absolute';
    btn.style.right = '18px';
    btn.style.bottom = '18px';
    btn.addEventListener('click', ()=>{
      // reset page: hide scene, show board again with fresh setup
      SCENE.style.display = 'none';
      document.getElementById('boardWrap').style.display = 'block';
      MSG.textContent = '';
      clearHighlights();
      makeBoard();
      btn.remove();
    });
    SCENE.appendChild(btn);
  }, 3600);
}

/* small UI helpers */
function shake(el){
  el.classList.add('shake');
  setTimeout(()=>el.classList.remove('shake'),450);
}

/* initialize */
makeBoard();

</script>
</body>
</html>
